<!DOCTYPE html>
<html>
<head>
  <script src="node_modules\vue\dist\vue.js"></script>
  <script src="node_modules\vuex\dist\vuex.js"></script>
  
  <style>
      table {
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 100%;
      }
      
      td, th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
      }
      
      tr:nth-child(even) {
          background-color: #dddddd;
      }
  </style>
</head>
<body>
  <div id="app">
  </div>

  <script>
    var STORAGE_KEY = 'todo-list';

    var todoStorage = {
      fetch: function () {
        var todos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]')
        todos.forEach(function (todo, index) {
          todo.id = index
        })
        todoStorage.uid = todos.length
        return todos
      },
      save: function (todos) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(todos))
      }
    }

    Vue.component('todo__input', {
      template: `
        <div>
        <input v-model="inputVal">
        <button v-on:click="addItem(inputVal)">Add item</button>
        </div>
        `,
      data() {
        return { inputVal: '' }
      },
      methods: {
        addItem: function (value) {
          store.commit('addItem', value)
        }
      }
    })

    Vue.component('todo__output', {
      template: `
        <table v-if="recievedArray.length">
            <tr>
              <th>Index</th>
              <th style="cursor: pointer;" v-on:click="sortbyName">Item</th>
              <th style="cursor: pointer;" v-on:click="sortbyDate">Date</th>
              <th>Time</th>
              <th></th>
            </tr>
            <tr v-for="(value, index) in recievedArray">
              <td>{{ index + 1 }}</td>
              <td>{{ value.itemName }}</td>
              <td>{{ value.date }}</td>
              <td>{{ value.time }}</td>
              <td><button v-on:click="removeItem(index)">Remove item</button></td>
            </tr>
        </table> 
      `,
      computed: {
        recievedArray () {
          return store.state.objects;
        }
      },
      methods: {
        sortbyName: function() {
          function compare(a, b) {
            if (a.itemName < b.itemName)
              return -1;
            if (a.itemName > b.itemName)
              return 1;
            return 0;
          }

          return this.recievedArray.sort(compare);
        },
        sortbyDate: function() {
          function compare(a, b) {
            if (a.date < b.date)
              return -1;
            if (a.date > b.date)
              return 1;
            return 0;
          }
          return this.recievedArray.sort(compare);
        },
        removeItem: function (index) {
          store.commit('removeItem', index)
        }
      }
    })

    Vue.component('todo', {
      template: `
      <div>
        <todo__input></todo__input>
        <todo__output></todo__output>
      </div>
      `
    })

    const store = new Vuex.Store({
      strict: true,
      state: {
        objects: todoStorage.fetch()
      },
      mutations: {
        addItem: function (state, value) {
          var fullDate = new Date().toLocaleString();
          state.objects.push({
            itemName: value,
            date: fullDate.substring(0, fullDate.indexOf(',')),
            time: fullDate.split(',')[1]
          });
          return todoStorage.save(state.objects);
        },
        removeItem: function (state, index) {
          state.objects.splice(index, 1);
          return todoStorage.save(state.objects);
        }
      }
    })

    var app = new Vue({
      store,
      template: "<todo></todo>"
    })

    app.$mount('#app');
  </script>
</body>
</html>